<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>Моите възложени тестове</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/styles/style.css">
</head>
<body>
  <div class="container my-4">
    <h1>Моите възложени тестове</h1>
    <table class="table table-bordered" id="assignedTestsTable">
      <thead>
        <tr>
          <th>Тест</th>
          <th>Описание</th>
          <th>Период</th>
          <th>Действие</th>
        </tr>
      </thead>
      <tbody>
        <!-- JS ще попълни тук -->
      </tbody>
    </table>
    <div id="noTests" class="alert alert-info" style="display:none;">Нямате възложени тестове.</div>
  </div>
  <script>
    fetch('/assigned-tests/mine')
      .then(res => res.json())
      .then(tests => {
        const tbody = document.querySelector('#assignedTestsTable tbody');
        if (!tests.length) {
          document.getElementById('noTests').style.display = '';
          return;
        }
        tests.forEach(test => {
          // Проверка дали тестът е в разрешения период
          const now = new Date();
          const start = new Date(test.start_time);
          const end = new Date(test.end_time);
          let action = '';
          if (now >= start && now <= end && test.status === 'assigned') {
            action = `<a href="/solve-test.html?test_id=${test.test_id}" class="btn btn-success btn-sm">Започни</a>`;
          } else if (now < start) {
            action = '<span class="text-warning">Още не е започнал</span>';
          } else if (now > end) {
            action = '<span class="text-danger">Изтекъл</span>';
          } else if (test.status === 'completed') {
            action = '<span class="text-success">Завършен</span>';
          }
          tbody.innerHTML += `
            <tr>
              <td>${test.title}</td>
              <td>${test.description}</td>
              <td>${test.start_time.replace('T', ' ').slice(0, 16)}<br>до<br>${test.end_time.replace('T', ' ').slice(0, 16)}</td>
              <td>${action}</td>
            </tr>
          `;
        });
      });
  </script>
</body>
</html>